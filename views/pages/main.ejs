<!DOCTYPE html>
<html>

<head lang="ja">
  <script>
    var modal; //modal dialog
    window.onload = function () {
      modal = document.getElementById("myModal"); //modal dialog
    }
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    // Enter検知で検索開始
    function Keyinput(e) {
      var input = document.getElementById("inputText");
      alert(input.value);
    }

    // 検索ボタン
    function Search() {
      var input = document.getElementById("inputText").value;
      var rowElement = document.getElementById("mainTable").rows;
      for (let cnt = 0; cnt < rowElement.length; cnt++) {
        if (!rowElement[cnt].id.includes(input)) {
          rowElement[cnt].style.display = "none";
        }
        else {
          rowElement[cnt].style.display = "";
        }
      }
    }

    //検索クリア
    function Reset() {
      var rowElement = document.getElementById("mainTable").rows;
      for (let cnt = 0; cnt < rowElement.length; cnt++) {
        rowElement[cnt].style.display = "";
      }
    }

    // 店名クリック → tr を取得してダイアログ表示
    function Dialog(e) {
      var parent = e.parentNode.parentNode.parentNode;
      Show(parent);
    }

    // ダイアログ表示
    function Show(e) {
      var selItem = e.getAttribute("id").split(",");
      if (selItem.length != 3) {
        alert("Selected Item Error.");
      }

      var title = document.getElementById('dialogTitle')
      title.innerHTML = selItem[0] + " - " + selItem[1];

      //画像
      var image = document.getElementById('ImagePanel')
      image.innerHTML = "<image class=\"modal_image\" src=\"./image/" + selItem[0] + ".jpg\"/>"

      //ツイッターリンク
      var tw_link = document.getElementById('TweetLink')
      tw_link.innerHTML = "<a href=\"http://twitter.com/share?url=https://trysail.jp/&text="
        + selItem[0] + "\" target=\"_blank\" class=\"D_TwBtn\"><span>Tweet</span></a>"

      // 食べログリンク
      var ta_link = document.getElementById('tabelogLink')
      ta_link.innerHTML = "<a href=\"https://tabelog.com/" + selItem[2] + "\" target=\"_blank\" class=\"D_tabeBtn\"><span>食べログ</span></a>"

      modal.style.display = "block";

      //ダイアログ中央配置
      var content = document.getElementById('myModalContent');
      content.style.top = (window.innerHeight - content.clientHeight) / 2 + "px";
      content.style.left = (window.innerWidth - content.clientWidth) / 2 + "px";

    }
  </script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="./css/style.css">
  <title>Document</title>
</head>

<body style="padding-top: 60px;">
  <header>
    <!-- タイトルdiv -->
    <div style="margin: 0 auto; display: flex; align-items: center;">
      <div style="width: 110px;">TestWeb</div>
      <div style="width: 110px; padding-left: 50px;">掲載店舗数：</div>
      <div style="width: 50px;"><%= items.length %></div>
      <div style="width: 170px;" class="cp_iptxt"><label class="ef"><input type="text" id="inputText" placeholder="駅名"
            class="i_search" onchange="Search()"></input></label></div>
      <div style="width: 50px;"><input type="button" value="検索" onclick="Search()"></div>
      <div style="width: 50px;"><input type="button" value="リセット" onclick="Reset()"></div>
    </div>
  </header>

  <!-- Table items -->
  <% const tr_s1='<tr class="tr_main" onclick id="'%>
  <% const tr_s2='"/>'%>
  <table class="t_main" border="0" id="mainTable">
    <tbody id="s_result">
      <% for(let i=0; i < items.length; i++) { %><%- tr_s1 + items[i].name + "," + items[i].station + "," + items[i].tabelog + tr_s2 %>
      <td style="width: 100px;">
        <div id="listImage" />
        <%- '<image src="./image/' + items[i].name + '.jpg" width="100%"></image>' %>
      </td>
      <td style="padding-left: 10px;">
        <div>
          <a href="javascript:void(0);" onclick="Dialog(this)"><%= items[i].name %></a>
          <span class="item_sub"> - <%= items[i].station %></span>
        </div>
        <div><span class="item_sub">掲載日: <%= items[i].date %></span></div>
      </td>
      </tr>
      <% } %>
    </tbody>
  </table>

  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div id="myModalContent" class="modal-content">
      <div class="modal_body" id="ImagePanel" style="width: 100%; margin: auto;"></div>
      <div class="modal_body">
        <div id="dialogTitle" />
      </div>
      <div>
        <table>
          <tr>
            <td style="width: 300px;">
              <section>
                <div id="TweetLink" />
              </section>
            </td>
            <td style="width: 300px;">
              <section>
                <div id="tabelogLink" />
              </section>
            </td>
          </tr>
        </table>
      </div>
    </div>
</body>

</html>